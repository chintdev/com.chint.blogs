---
title: 在浏览器输入 URL 到页面加载发生了什么？ # 文章标题
date: 2021-11-01 16:58:00 # 发布时间
author: zander # 文章作者
img: # 文章特征图，推荐使用图床(腾讯云、七牛云、又拍云等)来做图片的路径.如: http://xxx.com/xxx.jpg
top: true # 推荐文章（文章是否置顶）
hide: false # 隐藏文章，如果hide值为true，则文章不会在首页显示
cover: true # 文章是否需要加入到首页轮播封面中
coverImg: # 文章在首页轮播封面需要显示的图片路径，如果没有，则默认使用文章的特色图片
password:  # 文章阅读密码
toc: false # 是否开启 TOC，可以针对某篇文章单独关闭 TOC 的功能 `暂未开放`
mathjax: false # 是否开启数学公式支持 
summary: # 文章摘要
categories: Browser # 文章分类
tags: # 文章标签
  - DNS
  - HTTP
  - TCP
  - URL
keywords: # 文章关键字，SEO 时需要
reprintPolicy: # 文章转载规则 `暂时不支持`
---

`过程综述：`

1. DNS 解析
2. TCP 连接
3. 发送 HTTP 请求
4. 服务器处理请求并返回 HTTP 报文
5. 浏览器解析渲染页面
6. 连接结束

## 一. DNS 解析

1. `wiki`介绍:
   > 域名系统（domain name system，缩写：DNS）是互联网的一项服务。它作为将域名和 ip 地址相互映射的一个分布式数据库，能够使人更方便的访问互联网。DNS 使用 TCP 和 UDP 端口 53.当前，对于每一级域名长度的限制是 63 个字符，域名总长度则不能朝服哦 253 个字符。<font color=red>最基本的作用就是将域名翻译成对应的 IP 地址</font>
2. 域名解析过程

   - 检查缓存
     1. 浏览器缓存
        > 用户通过浏览器访问某域名时，浏览器首先会在自己的缓存中查找是否有该域名对用的 ip 地址（若曾经访问过，没有被清除，就会存在）
     2. 系统缓存
        > 检查系统的 hosts 文件有没有这个域名的映射，如果有，直接返回
   - ISP（互联网服务提供商）DNS 缓存
     > 如果 hosts 与本地的 DNS 解析器缓存都没有相应的网址映射关系，首先会找 TCP/IP 参数中设置的首选 DNS 服务器，在此我们叫它 DNS 服务器，此服务器收到查询时，如果要查询的域名，包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析，此解析具有权威性。
   - 根域名服务器
     > 当以上均未完成，则进入根服务器查询，全球仅有 13 台服务器，1 个根域名服务器，其余 12 台为辅助域名服务器。根域名收到请求后会查询域名文件记录，若无则将其管辖的顶级域名（如： .com）服务器 IP 告诉本地 DNS 服务器
   - 顶级域名服务器
     > 顶级域名服务器收到请求后查看区域文件记录，若无则将其管辖范围内主域名服务器 IP 地址告诉本地服务器
   - 主域名服务器
     > 主域名服务器接收到请求以后查询自己的缓存，如果没有则进入下一级域名服务器查找，并重复该步骤直至找到正确记录
   - 保存结果到缓存

     > 本地域名服务器吧返回的结果保存到缓存

![DNS](/chintdev.github.io/images/dns.jpg)

## 二. TCP 链接

1. 第一次握手：CLient 将标识位 SYN 置为 1，随机产生一个值 seq=j，并将该数据包发送至 Server，Client 进入 SYN_SEND 状态，等待 Server 确认。

2. 第二次握手：Server 收到数据包后由标志位 SYN=1 知道 Client 请求建立链接，Server 将标识位 SYN 和 ACK 都置为 1，ACK=j+1，随机产生一个值 seq=K，并将该数据包发送给 Client 以确认连接请求。

3. 第三次握手：Client 收到确认后，检查 ACK 是否为 j+1，ACK 是否为 1，如果正确则将标志位 ACK 置为 1，ACK=k+1,并将该数据发送给 Server，Server 检查 ACK 是否为 k+1,ACK 是否为 1，如果正确则建立连接成功，Client 和 Server 进入 ESTABLISHED 状态，完成三次握手，随后 Client 与 Server 之间可以开始传输数据了。

### 三. HTTP 请求

> 发送 HTTP 请求的过程就是构建 HTTP 请求报文并通过 TCP 协议中发送服务器指定端口（HTTP 协议 80/8080，HTTPS 协议 443）.
> HTTP 请求报文由三部分组成： 请求头，请求行，请求体

#### 四. 服务器处理请求返回 HTTP 报文

> 后端从在固定的端口接收到 TCP 报文开始，这一部分对于编程语言中的 socket。他会对 TCP 连接进行处理，对 HTTP 协议进行解析，并按照报文格式进一步封装成 HTTP Request 对象，供上层使用。
> HTTP 响应报文包括三部分：状态码，响应报头，响应报文

##### 五. 浏览器解析渲染页面

> 浏览器是一个边间谍西边渲染的过程。首先浏览器解析 HTML 文件构成 DOM 树，然后解析 CSS 文件构建渲染树，等到渲染树构建完成后，浏览器开始布局渲染树并将其绘制到屏幕上。这个过程比较复杂。

###
